<html>

<head>
    <title>{{add_edit_delete}}</title>
</head>

<body>
    <div id="form">
    </div><br><br>
    <div>
        <button style="position: relative;left: 20%;font-size:2em;" onclick="submit()">Submit</button>
    </div>
    <div id="ans">
    </div>
</body>
<script>
    let page_info = {
        
        "form json": "path/all_posts_table_columns.json",
        "add": {
            "server url": "add_db"
        },
        "edit": {
            "server url": "edit_db"
        },
        "delete": {
            "server url": "delete_db"
        },
        "create question": {
            "text": (obj) => {
                var html = ""
                html += `<h2>${obj["name"]} ${(!obj["optional"])?`<font color="red">*</font>`:""}</h2>`
                html += `<input id="${obj["name"]}" type="text" value="${obj["value"]}" placeholder="${obj["placeholder"]}">`
                return html
            },
            "option": (obj) => {
                var html = ""
                html += `<h2>${obj["name"]} ${(!obj["optional"])?`<font color="red">*</font>`:""}</h2>`
                html += `<select id="${obj["name"]}" value="${obj["value"]}">`
                let suggestions=Array.from(obj["suggestions"])
                suggestions.forEach(el => {
                    html += `<option>${el}</option>`
                })
                html += `</select>`
                return html
            },
            "textarea": (obj) => {
                var html = ""
                html += `<h2>${obj["name"]} ${(!obj["optional"])?`<font color="red">*</font>`:""}</h2>`
                html += `<textarea style="width:430px;height:100px;" id="${obj["name"]}" >${obj["value"]}</textarea>`
                return html
            },
            "date": (obj) => {
                var html = ""
                html += `<h2>${obj["name"]} ${(!obj["optional"])?`<font color="red">*</font>`:""}</h2>`
                html += `<input id="${obj["name"]}" type="date">`
                return html
            },

        }
    }
    let add_edit_delete = document.title

    function createQuestion(obj) {
        
        var html = ""
        html += page_info["create question"][obj["type"]](obj)
        return html
    }

    async function createPage() {
        let form = document.getElementById("form")
        let columns_text = await sendToServer(page_info["form json"])
        let columns_json = await JSON.parse(columns_text)
        let columns=await Array.from(columns_json)
        var html=""
        
        columns.forEach(col => {
            html+=createQuestion(col)
        })
        form.innerHTML=html

    }
    //alert(add_edit_delete)
    async function sendToServer(url, data = "", get_post = "GET", type = "application/json") {
        //"application/x-www-form-urlencoded"
        var response;
        if (get_post == "post" || get_post == "POST") {

            response = await fetch(url, {
                method: get_post,
                "Content-Type": type,
                body: data
            });
        } else {
            response = await fetch(url)
        }
        //let val = await response.json();
        let val = await response.text();
        return val
    }
    function toUrlEncoded(columns_info){
        var url=""
        columns_info.forEach((col,index) => {
            var val=document.getElementById(col["name"]).value
            if(index<columns_info.length-1){
                
                url+=`${col["name"]}=${val}&`
            }else{
                url+=`${col["name"]}=${val}`
            }
        })
        return url
    }
    function jsonData(columns){
        var data={}
        columns.forEach((col) => {
            var val=document.getElementById(col["name"]).value
            data[col["name"]]=val
        })
        return data
    }
    async function getData(){
        let columns_text = await sendToServer(page_info["form json"])
        let columns_json = await JSON.parse(columns_text)
        let columns=await Array.from(columns_json)
        return  jsonData(columns)    
        
    }
    async function submit(){
        let div=document.getElementById("ans")
        let data=await getData()
        let ans=await sendToServer(page_info[add_edit_delete]["server url"],JSON.stringify(data),"post")
        div.innerHTML=ans
    }
    //sendToServer(page_info["form json"])
    function init() {
        let columns = sendToServer(page_info["form json"])
        createPage()
    }
    window.onload = init()

</script>

</html>
