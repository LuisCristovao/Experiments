<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <textarea></textarea>
    <button onclick="connect()">connect</button><br>
    <img ><br>
    <textarea>

    </textarea><br>
    <button onclick="send()">Send</button>
  </body>
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <!-- <script src="mywrtc.js"></script> -->
  <script>
    var peer = new Peer();
    var conn = null;
    peer.on("open", function (id) {
      console.log("My peer ID is: " + id);
      document.getElementsByTagName("img")[0].setAttribute("src","https://api.qrserver.com/v1/create-qr-code/?data=http://192.168.1.88:5500/peerJs/pc.html?"+id+"&amp;size=100x100")
    });
    //on connection
    peer.on("connection", function (_conn) {
      console.log("1connected with " + _conn.peer);
      // Send messages
      conn = _conn;
      setTimeout(()=>{conn.send("Hello22")},200);
      conn.on("data", (data) => {
        console.log("Received3: ", data);
        document.getElementsByTagName("textarea")[0].value+=data+'\n'
      });
    });

    function connect() {
      conn = peer.connect(document.getElementsByTagName("textarea")[0].value);
      conn.on("connection",(_conn)=>{
        console.log("connected with " + _conn.peer);
      })
      conn.on("open", function () {
        // Receive messages
        conn.on("data", function (data) {
          console.log("Received1", data);
          document.getElementsByTagName("textarea")[0].value+=data+'\n'
        });

        // Send messages
        conn.send("Hello!");
      });
    }
    function connect2() {
      conn = peer.connect(window.location.search.split("?")[1]);
      conn.on("connection",(_conn)=>{
        console.log("connected with " + _conn.peer);
      })
      conn.on("open", function () {
        // Receive messages
        conn.on("data", function (data) {
          console.log("Received0", data);
          document.getElementsByTagName("textarea")[0].value+=data+'\n'
        });
        // Send messages
        conn.send("Hello!");
      });
    }
    function send(){
        conn.send(document.getElementsByTagName("textarea")[1].value)
    }
    if(window.location.search.split("?")[1]!=undefined){
        setTimeout(()=>{connect2()},500)
    }
  </script>
</html>
